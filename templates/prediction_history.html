<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="../static/favicon.ico">
  <title>Prediction History</title>

  <!-- page-specific styles first, then shared styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles1.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style2.css') }}" />


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <!-- header -->
  <header class="navbar">
    <nav>
      <div class="nav-left">
        <a href="{{ url_for('home') }}">
          <img src="../static/images/logo.png" alt="EVision Logo" class="logo" />
        </a>
      </div>

      <!-- hamburger for mobile -->
      <div class="menu-icon" onclick="toggleMenu()" aria-label="Menu" role="button" tabindex="0">☰</div>

      <div class="nav-right">
        {% if current_user.is_authenticated %}
        <a href="#"><i class="fa-solid fa-user"></i> Welcome, {{ current_user.username }}</a>
        <a href="{{ url_for('logout') }}">Logout <i class="fa-solid fa-right-from-bracket"></i></a>
        {% else %}
        <a href="{{ url_for('login') }}" onclick="showLoginForm()">Login</a>
        <a href="{{ url_for('signup') }}" onclick="showSignupForm()">Signup</a>
        {% endif %}
        <a href="{{ url_for('home') }}">Home <i class="fa-solid fa-home"></i></a>
        <a href="{{ url_for('weather_page') }}">Weather <i class="fa-solid fa-cloud"></i></a>
        <a href="{{ url_for('how_it_works') }}">How It Works <i class="fa-solid fa-question"></i></a>
      </div>
    </nav>
  </header>

  <!-- main content -->
  <main style="min-height: 70vh; padding: 20px;">
    <h2 style="text-align: center; margin-top: 20px;">
      Your Prediction History
    </h2>


    {% if predictions %}
    <div class="history-table-wrapper">
      <table class="history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Prediction</th>
          </tr>
        </thead>
        <tbody>
          {% for prediction in predictions %}
          <tr>
            <td data-label="Date">{{ prediction.date }}</td>
            <td data-label="Time">{{ prediction.hour }}</td>
            <td data-label="Prediction">{{ prediction.prediction }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-------- graph ---------- -->
    <div class="graph">
      <canvas id="predictionChart"></canvas>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </div>

    {% else %}
    <p style="text-align: center; "class="no-data">You don't have any predictions yet.</p>
    {% endif %}
  </main>

  <!-- footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-left">
        <img src="../static/images/logo.png" alt="EV Bike Logo" class="footer-logo" />
        <p>Ride Smart, Go Green. Rent an EV bike and explore the city with ease.</p>
      </div>

      <div class="footer-right">
        <h3>Contact Us</h3>
        <p>Email: support@evbikerentals.com</p>
        <p>Phone: +123 456 7890</p>
        <p>Location: Green City, EV Street</p>
        <div class="social-icons">
          <a href="#" class="social-link"><i class="fab fa-facebook"></i></a>
          <a href="#" class="social-link"><i class="fab fa-twitter"></i></a>
          <a href="#" class="social-link"><i class="fab fa-instagram"></i></a>
          <a href="#" class="social-link"><i class="fab fa-linkedin"></i></a>
          <a href="#" class="social-link"><i class="fab fa-youtube"></i></a>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <p>© 2025 EV Bike Rentals. All Rights Reserved.</p>
    </div>
  </footer>

  <!-- data for chart (server-side rendered) -->
  <script id="hours-data" type="application/json">{{ hours | tojson }}</script>
  <script id="values-data" type="application/json">{{ values | tojson }}</script>

  <script>
    // Chart rendering
    (function () {
      const hoursEl = document.getElementById('hours-data');
      const valuesEl = document.getElementById('values-data');
      if (hoursEl && valuesEl && document.getElementById('predictionChart')) {
        const hours = JSON.parse(hoursEl.textContent || "[]");
        const values = JSON.parse(valuesEl.textContent || "[]");
        const ctx = document.getElementById('predictionChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: hours,
            datasets: [{
              label: 'Predicted Demand',
              data: values,
              borderColor: 'rgba(54, 162, 235, 1)',
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              fill: true,
              tension: 0.3,
              pointRadius: 4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: { title: { display: true, text: 'Hour' } },
              y: { title: { display: true, text: 'Prediction Count' }, beginAtZero: true }
            }
          }
        });
      }
    })();
  </script>

  <!-- menu toggle + accessibility handlers -->
  <script>
    function toggleMenu() {
      const nav = document.querySelector('.nav-right');
      const icon = document.querySelector('.menu-icon');
      if (!nav || !icon) return;
      nav.classList.toggle('open');
      const expanded = nav.classList.contains('open');
      icon.setAttribute('aria-expanded', expanded ? 'true' : 'false');
    }

    // close menu when a nav link is clicked (mobile) or click outside
    document.addEventListener('click', function (e) {
      const nav = document.querySelector('.nav-right');
      const menuIcon = document.querySelector('.menu-icon');
      if (!nav || !menuIcon) return;

      if (e.target.closest('.nav-right a')) {
        nav.classList.remove('open');
        menuIcon.setAttribute('aria-expanded', 'false');
      }

      if (nav.classList.contains('open') && !e.target.closest('.nav-right') && !e.target.closest('.menu-icon')) {
        nav.classList.remove('open');
        menuIcon.setAttribute('aria-expanded', 'false');
      }
    });

    // close on Esc
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        const nav = document.querySelector('.nav-right');
        const icon = document.querySelector('.menu-icon');
        if (nav) nav.classList.remove('open');
        if (icon) icon.setAttribute('aria-expanded', 'false');
      }
    });

    // keyboard Enter/Space activates hamburger for accessibility
    document.addEventListener('keydown', function (e) {
      const icon = document.querySelector('.menu-icon');
      if (!icon) return;
      if ((e.key === 'Enter' || e.key === ' ') && document.activeElement === icon) {
        e.preventDefault();
        toggleMenu();
      }
    });
  </script>
</body>

</html>